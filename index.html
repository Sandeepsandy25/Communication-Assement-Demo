<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cognizant Communication Mock — Downloadable</title>
  <style>
    body{font-family:system-ui,Arial;max-width:900px;margin:20px auto;padding:20px;color:#111}
    header{display:flex;align-items:center;gap:12px}
    h1{margin:0;font-size:20px}
    section{border:1px solid #ddd;padding:14px;border-radius:8px;margin-top:16px}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    button{padding:8px 12px;border-radius:6px;border:0;background:#1e88e5;color:white;cursor:pointer}
    .small{font-size:13px;color:#555}
    .mcq{margin-top:10px}
    .hidden{display:none}
    textarea{width:100%;height:90px}
    .controls{display:flex;gap:8px;align-items:center}
  </style>
</head>
<body>
  <header>
    <h1>Cognizant Communication — Interactive Mock (Downloadable)</h1>
  </header>
  <p class="small">Instructions: Open this file in Chrome. Allow microphone access when prompted. The mock follows the Cognizant syllabus: Pronunciation, Speaking/Fluency, Grammar, Listening. Total practice time ~60 minutes. You can record answers and save audio files locally.</p>

  <section id="pronunciation">
    <h2>Section 1 — Pronunciation (15 minutes)</h2>
    <p class="small">Listen to each sentence, then <strong>record yourself</strong> reading it aloud. Use the Play buttons to hear model audio (generated by your browser's TTS).</p>
    <ol>
      <li>"The entrepreneur launched an innovative solution to a global problem." <div class="controls"><button onclick="speakText(this,0)">Play</button><button onclick="startRec(0)">Record</button><button onclick="stopRec(0)">Stop</button></div></li>
      <li>"Effective communication requires both clarity and confidence." <div class="controls"><button onclick="speakText(this,1)">Play</button><button onclick="startRec(1)">Record</button><button onclick="stopRec(1)">Stop</button></div></li>
      <li>"The temperature fluctuates dramatically in this region." <div class="controls"><button onclick="speakText(this,2)">Play</button><button onclick="startRec(2)">Record</button><button onclick="stopRec(2)">Stop</button></div></li>
      <li>"The architecture of this building is truly magnificent." <div class="controls"><button onclick="speakText(this,3)">Play</button><button onclick="startRec(3)">Record</button><button onclick="stopRec(3)">Stop</button></div></li>
      <li>"Please schedule the presentation for Wednesday afternoon." <div class="controls"><button onclick="speakText(this,4)">Play</button><button onclick="startRec(4)">Record</button><button onclick="stopRec(4)">Stop</button></div></li>
    </ol>
    <p class="small">Saved recordings will appear below each item when you stop recording. Right-click the link and choose "Save link as..." to download your audio.</p>
  </section>

  <section id="speaking">
    <h2>Section 2 — Speaking / Fluency (15 minutes)</h2>
    <p class="small">Speak for <strong>1–2 minutes</strong> on each prompt. Use the Record button and the built-in timer. Try to speak continuously.</p>
    <div>
      <p><strong>Prompt A:</strong> Describe your favorite hobby and explain why you enjoy it.</p>
      <div class="controls"><button onclick="startSpeakRec(0)">Record (1-2 min)</button><button onclick="stopSpeakRec(0)">Stop</button><span id="timer0" class="small"></span></div>
      <div id="speaklink0"></div>
    </div>
    <hr>
    <div>
      <p><strong>Prompt B:</strong> Talk about a challenging project or task you’ve completed recently.</p>
      <div class="controls"><button onclick="startSpeakRec(1)">Record (1-2 min)</button><button onclick="stopSpeakRec(1)">Stop</button><span id="timer1" class="small"></span></div>
      <div id="speaklink1"></div>
    </div>
    <p class="small">Tip: Aim for coherent structure — intro, 2–3 points with examples, and a short conclusion.</p>
  </section>

  <section id="grammar">
    <h2>Section 3 — Grammar (15 minutes)</h2>
    <p class="small">Choose the correct option and click "Check answers" to see feedback and score.</p>
    <div id="mcqcontainer">
      <div class="mcq">1. She ____ to the gym every morning.<br>
        <label><input type="radio" name="q1" value="go"> go</label>
        <label><input type="radio" name="q1" value="goes"> goes</label>
        <label><input type="radio" name="q1" value="gone"> gone</label>
      </div>
      <div class="mcq">2. If I ____ you, I would take the offer.<br>
        <label><input type="radio" name="q2" value="was"> was</label>
        <label><input type="radio" name="q2" value="were"> were</label>
        <label><input type="radio" name="q2" value="am"> am</label>
      </div>
      <div class="mcq">3. He hasn’t finished the report, ____?<br>
        <label><input type="radio" name="q3" value="has he"> has he</label>
        <label><input type="radio" name="q3" value="hasn't he"> hasn't he</label>
        <label><input type="radio" name="q3" value="did he"> did he</label>
      </div>
      <div class="mcq">4. The manager asked whether the meeting ____ scheduled.<br>
        <label><input type="radio" name="q4" value="is"> is</label>
        <label><input type="radio" name="q4" value="was"> was</label>
        <label><input type="radio" name="q4" value="will"> will</label>
      </div>
      <div class="mcq">5. Neither of the students ____ absent today.<br>
        <label><input type="radio" name="q5" value="was"> was</label>
        <label><input type="radio" name="q5" value="were"> were</label>
        <label><input type="radio" name="q5" value="are"> are</label>
      </div>
      <div class="mcq">6. The movie was interesting, ____ the ending was predictable.<br>
        <label><input type="radio" name="q6" value="but"> but</label>
        <label><input type="radio" name="q6" value="because"> because</label>
        <label><input type="radio" name="q6" value="so"> so</label>
      </div>
      <div class="mcq">7. I prefer coffee ____ tea.<br>
        <label><input type="radio" name="q7" value="to"> to</label>
        <label><input type="radio" name="q7" value="than"> than</label>
        <label><input type="radio" name="q7" value="over"> over</label>
      </div>
      <div class="mcq">8. She has been working here ____ five years.<br>
        <label><input type="radio" name="q8" value="since"> since</label>
        <label><input type="radio" name="q8" value="from"> from</label>
        <label><input type="radio" name="q8" value="for"> for</label>
      </div>
      <div class="mcq">9. If it rains, we ____ the picnic.<br>
        <label><input type="radio" name="q9" value="will cancel"> will cancel</label>
        <label><input type="radio" name="q9" value="would cancel"> would cancel</label>
        <label><input type="radio" name="q9" value="canceled"> canceled</label>
      </div>
      <div class="mcq">10. The project must be completed ____ Friday.<br>
        <label><input type="radio" name="q10" value="until"> until</label>
        <label><input type="radio" name="q10" value="by"> by</label>
        <label><input type="radio" name="q10" value="before"> before</label>
      </div>
      <div style="margin-top:10px"><button onclick="checkMCQ()">Check answers</button> <span id="mcqscore" class="small"></span></div>
    </div>
  </section>

  <section id="listening">
    <h2>Section 4 — Listening Comprehension (15 minutes)</h2>
    <p class="small">Click Play to listen to each short passage (browser-generated audio). After listening, answer the questions below each passage.</p>

    <div>
      <p><strong>Passage 1 (about company policy)</strong></p>
      <button onclick="speakTextPassage(0)">Play Passage 1</button>
      <p class="small">Passage text (for reference): "A company decided to change its remote work policy due to decreasing productivity. Employees were asked to return to the office three days a week. The management hopes this will increase collaboration and communication among teams."</p>
      <ol>
        <li>Why did the company change its policy? <input id="L1Q1"></li>
        <li>How many days are employees expected to come to the office? <input id="L1Q2"></li>
        <li>What improvement does management expect? <input id="L1Q3"></li>
      </ol>
    </div>

    <div>
      <p><strong>Passage 2 (short story)</strong></p>
      <button onclick="speakTextPassage(1)">Play Passage 2</button>
      <p class="small">Passage text: "Rina missed her train but decided to work from a nearby cafe. She used that time to prepare notes and later presented them in the afternoon meeting, which impressed her manager."</p>
      <ol>
        <li>Where did Rina work after missing the train? <input id="L2Q1"></li>
        <li>What did she prepare? <input id="L2Q2"></li>
        <li>Who was impressed? <input id="L2Q3"></li>
      </ol>
    </div>
    <div style="margin-top:10px"><button onclick="checkListening()">Check Listening Answers</button> <span id="lsresult" class="small"></span></div>
  </section>

  <section>
    <h2>Submit & Score</h2>
    <p class="small">Click the buttons below to get a summary score for grammar & listening. Pronunciation and speaking are subjective — listen to your recordings and self-evaluate using the score sheet below.</p>
    <button onclick="showScore()">Show Grammar + Listening Score</button>
    <div id="finalscore" class="small"></div>
    <h3>Self-evaluation sheet (copy to paper)</h3>
    <p class="small">Pronunciation (out of 10), Speaking/Fluency (out of 15), Grammar (out of 15), Listening (out of 20). Total 60.</p>
  </section>

  <script>
  // Texts for TTS
  const pronTexts = [
    "The entrepreneur launched an innovative solution to a global problem.",
    "Effective communication requires both clarity and confidence.",
    "The temperature fluctuates dramatically in this region.",
    "The architecture of this building is truly magnificent.",
    "Please schedule the presentation for Wednesday afternoon."
  ];

  const passageTexts = [
    "A company decided to change its remote work policy due to decreasing productivity. Employees were asked to return to the office three days a week. The management hopes this will increase collaboration and communication among teams.",
    "Rina missed her train but decided to work from a nearby cafe. She used that time to prepare notes and later presented them in the afternoon meeting, which impressed her manager."
  ];

  function speakText(btn, i) {
    const ut = new SpeechSynthesisUtterance(pronTexts[i]);
    ut.rate = 0.95;
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(ut);
  }

  function speakTextPassage(i) {
    const ut = new SpeechSynthesisUtterance(passageTexts[i]);
    ut.rate = 0.95;
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(ut);
  }

  // Recording setup
  let mediaRecorderArr = [];
  let recordedChunks = [[], [], [], [], []];

  async function startRec(i) {
    if (!navigator.mediaDevices) return alert('Microphone not supported in this browser. Use Chrome.');
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    const mr = new MediaRecorder(stream);
    mediaRecorderArr[i] = mr;
    recordedChunks[i] = [];
    mr.ondataavailable = function (e) { if (e.data.size > 0) recordedChunks[i].push(e.data); };
    mr.onstop = function () {
      const blob = new Blob(recordedChunks[i], { type: 'audio/webm' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'pron_' + i + '.webm';
      a.innerText = 'Download recording';
      const container = document.getElementById('pronunciation');
      container.appendChild(document.createElement('div')).appendChild(a);
    };
    mr.start();
  }

  function stopRec(i) {
    if (mediaRecorderArr[i]) mediaRecorderArr[i].stop();
  }

  // Speaking section recording (longer, with timer)
  let speakMR = [null, null];
  let speakChunks = [[], []];
  let timers = [null, null];

  function startSpeakRec(i) {
    if (!navigator.mediaDevices) return alert('Microphone not supported. Use Chrome.');
    navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
      const mr = new MediaRecorder(stream);
      speakMR[i] = mr;
      speakChunks[i] = [];
      mr.ondataavailable = e => { if (e.data.size > 0) speakChunks[i].push(e.data); };
      mr.onstop = () => {
        const blob = new Blob(speakChunks[i], { type: 'audio/webm' });
        const url = URL.createObjectURL(blob);
        const link = document.getElementById('speaklink' + i);
        link.innerHTML = '';
        const a = document.createElement('a');
        a.href = url;
        a.download = 'speaking_' + i + '.webm';
        a.innerText = 'Download speaking ' + (i + 1);
        link.appendChild(a);
      };
      mr.start();
      // 2-minute timer display
      let sec = 0;
      document.getElementById('timer' + i).innerText = '(recording: 0s)';
      timers[i] = setInterval(() => {
        sec++;
        document.getElementById('timer' + i).innerText = '(recording: ' + sec + 's)';
        if (sec >= 120) { stopSpeakRec(i); }
      }, 1000);
    });
  }

  function stopSpeakRec(i) {
    if (speakMR[i]) speakMR[i].stop();
    clearInterval(timers[i]);
    document.getElementById('timer' + i).innerText = '';
  }

  // Grammar answers check
  const answers = { q1: 'goes', q2: 'were', q3: 'has he', q4: 'was', q5: 'was', q6: 'but', q7: 'to', q8: 'for', q9: 'will cancel', q10: 'by' };

  function checkMCQ() {
    let score = 0;
    for (let i = 1; i <= 10; i++) {
      const name = 'q' + i;
      const els = document.getElementsByName(name);
      let val = '';
      for (const e of els) if (e.checked) val = e.value;
      if (val === answers[name]) score += 1;
    }
    document.getElementById('mcqscore').innerText = 'Score: ' + score + '/10';
    return score;
  }

  function checkListening() {
    let c = 0;
    if (document.getElementById('L1Q1').value.toLowerCase().includes('product') || document.getElementById('L1Q1').value.toLowerCase().includes('productivity')) c++;
    if (document.getElementById('L1Q2').value.includes('3') || document.getElementById('L1Q2').value.toLowerCase().includes('three')) c++;
    if (document.getElementById('L1Q3').value.toLowerCase().includes('collaboration') || document.getElementById('L1Q3').value.toLowerCase().includes('communication')) c++;
    if (document.getElementById('L2Q1').value.toLowerCase().includes('cafe')) c++;
    if (document.getElementById('L2Q2').value.toLowerCase().includes('notes')) c++;
    if (document.getElementById('L2Q3').value.toLowerCase().includes('manager')) c++;
    document.getElementById('lsresult').innerText = 'Listening: ' + c + '/6 (each correct =1)';
    return c;
  }

  // ✅ FIXED version of showScore()
  function showScore() {
    const g = checkMCQ();
    const l = checkListening();
    const total = Math.round((g / 10) * 15 + (l / 6) * 20); // scaled

    document.getElementById('finalscore').innerText = `
Scaled score: Grammar (${g}/10 → ${Math.round((g / 10) * 15)}/15) + Listening (${l}/6 → ${Math.round((l / 6) * 20)}/20) = ${total}/35 (out of 35)
Use self-eval for Pronunciation (0–10) and Speaking (0–15) to reach total out of 60.
`;
  }

  // Prevent text selection on double-clicks
  document.addEventListener('dblclick', e => e.preventDefault());
</script>

</body>
</html>
