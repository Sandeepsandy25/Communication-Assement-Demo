<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cognizant Communication Mock — Fully Auto-Evaluated</title>
<style>
body{font-family:system-ui,Arial;max-width:900px;margin:20px auto;padding:20px;color:#111}
header{display:flex;align-items:center;gap:12px}
h1{margin:0;font-size:20px}
section{border:1px solid #ddd;padding:14px;border-radius:8px;margin-top:16px}
.row{display:flex;gap:12px;flex-wrap:wrap}
button{padding:8px 12px;border-radius:6px;border:0;background:#1e88e5;color:white;cursor:pointer}
.small{font-size:13px;color:#555}
.mcq{margin-top:10px}
.controls{display:flex;gap:8px;align-items:center}
.correct{color:green;font-weight:bold;margin-left:10px}
.wrong{color:red;font-weight:bold;margin-left:10px}
</style>
</head>
<body>
<header>
<h1>Cognizant Communication — Fully Auto-Evaluated Mock</h1>
</header>
<p class="small">Open in Chrome. Allow microphone access. Test automatically evaluates Pronunciation, Speaking, Grammar, and Listening.</p>

<section id="pronunciation"><h2>Section 1 — Pronunciation</h2><ol></ol></section>
<section id="speaking"><h2>Section 2 — Speaking / Fluency</h2><div></div></section>
<section id="grammar"><h2>Section 3 — Grammar</h2><div id="mcqcontainer"></div></section>
<section id="listening"></section>

<section>
<h2>Submit & Score</h2>
<button onclick="showScore()">Evaluate & Show Score</button>
<div id="finalscore" class="small"></div>
<button onclick="nextTest()">Next Test ➡️</button>
</section>

<script>
/* ------------------ DATA ------------------ */
const pronSets = [
  ["The entrepreneur launched an innovative solution to a global problem.","Effective communication requires both clarity and confidence.","The temperature fluctuates dramatically in this region.","The architecture of this building is truly magnificent.","Please schedule the presentation for Wednesday afternoon."],
  ["Technology is evolving faster than ever before.","Global warming affects every continent on Earth.","Teamwork and dedication lead to success.","Artificial intelligence is transforming industries.","A balanced diet is essential for a healthy life."]
];
const speakSets = [
  ["Describe your favorite hobby and explain why you enjoy it.","Talk about a challenging project or task you’ve completed recently."],
  ["Describe a memorable trip you have taken.","Explain a skill you would like to learn and why."]
];
const grammarSets = [
  { questions:[{ q:"She ____ to the gym every morning.", opts:["go","goes","gone"], ans:"goes" },
               { q:"If I ____ you, I would take the offer.", opts:["was","were","am"], ans:"were" },
               { q:"He hasn’t finished the report, ____?", opts:["has he","hasn't he","did he"], ans:"has he" },
               { q:"The manager asked whether the meeting ____ scheduled.", opts:["is","was","will"], ans:"was" },
               { q:"Neither of the students ____ absent today.", opts:["was","were","are"], ans:"was" }]},
  { questions:[{ q:"They ____ playing football yesterday.", opts:["are","were","was"], ans:"were" },
               { q:"By next month, we ____ our exams.", opts:["finish","will finish","will have finished"], ans:"will have finished" },
               { q:"She didn't come, ____?", opts:["did she","does she","didn't she"], ans:"did she" },
               { q:"The book ____ by my friend.", opts:["was written","written","is writing"], ans:"was written" },
               { q:"I have lived here ____ 2018.", opts:["for","since","from"], ans:"since" }]}
];
const listeningSets = [
  { passage:"A company decided to change its remote work policy due to decreasing productivity. Employees were asked to return to the office three days a week. The management hopes this will increase collaboration and communication among teams.",
    qs:[{id:"L1Q1",text:"Why did the company change its policy?",ans:"productivity"},
        {id:"L1Q2",text:"How many days are employees expected to come to the office?",ans:"three"},
        {id:"L1Q3",text:"What improvement does management expect?",ans:"collaboration"}]},
  { passage:"The city introduced electric buses to reduce pollution. Passengers found them quieter and more comfortable than regular buses. The government plans to expand the service next year.",
    qs:[{id:"L2Q1",text:"Why were electric buses introduced?",ans:"pollution"},
        {id:"L2Q2",text:"How did passengers find them?",ans:"comfortable"},
        {id:"L2Q3",text:"What will the government do next year?",ans:"expand"}]}
];

/* ------------------ UTIL ------------------ */
function shuffleArray(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]} return a}

/* ------------------ STATE ------------------ */
let usedSets=[];
let currentSet={pron:0,speak:0,grammar:0,listening:0};
let speakMR=[],speakChunks=[],timers=[];
let mediaRecorderArr=[],recordedChunks=[];
let currentGrammarQuestions=[];

/* ------------------ LOAD SET ------------------ */
function loadSet(i){
  currentSet={pron:i,speak:i,grammar:i,listening:i};
  renderPronunciation(); renderSpeaking(); renderGrammar(); renderListening();
  document.getElementById("finalscore").innerText="";
}

/* ------------------ PRON ------------------ */
function renderPronunciation(){
  const section=document.querySelector("#pronunciation ol"); section.innerHTML="";
  const sentences=shuffleArray([...pronSets[currentSet.pron]]);
  sentences.forEach((t,i)=>{
    const li=document.createElement("li");
    li.innerHTML=`"${t}" <div class="controls">
      <button onclick="speakText(${i})">Play</button>
      <button onclick="startRec(${i})">Record</button>
      <button onclick="stopRec(${i})">Stop</button>
    </div>`;
    section.appendChild(li);
  });
}
function speakText(i){
  const ut=new SpeechSynthesisUtterance(pronSets[currentSet.pron][i]);
  ut.rate=0.95; window.speechSynthesis.cancel(); window.speechSynthesis.speak(ut);
}
async function startRec(i){
  const stream=await navigator.mediaDevices.getUserMedia({audio:true});
  const mr=new MediaRecorder(stream); mediaRecorderArr[i]=mr; recordedChunks[i]=[];
  mr.ondataavailable=e=>{if(e.data.size>0)recordedChunks[i].push(e.data)};
  mr.onstop=()=>{
    const blob=new Blob(recordedChunks[i],{type:'audio/webm'});
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a'); a.href=url; a.download='pron_'+i+'.webm'; a.innerText='Download recording';
    document.querySelector("#pronunciation").appendChild(a);
  };
  mr.start();
}
function stopRec(i){if(mediaRecorderArr[i])mediaRecorderArr[i].stop();}

/* ------------------ SPEAKING ------------------ */
function renderSpeaking(){
  const container=document.querySelector("#speaking div"); container.innerHTML="";
  const prompts=shuffleArray([...speakSets[currentSet.speak]]);
  prompts.forEach((prompt,i)=>{
    const div=document.createElement("div");
    div.innerHTML=`<p><strong>Prompt ${String.fromCharCode(65+i)}:</strong> ${prompt}</p>
      <div class="controls">
        <button onclick="startSpeakRec(${i})">Record</button>
        <button onclick="stopSpeakRec(${i})">Stop</button>
        <span id="timer${i}" class="small"></span>
      </div>
      <div id="speaklink${i}"></div><hr>`;
    container.appendChild(div);
  });
}
function startSpeakRec(i){
  navigator.mediaDevices.getUserMedia({audio:true}).then(stream=>{
    const mr=new MediaRecorder(stream); speakMR[i]=mr; speakChunks[i]=[];
    mr.ondataavailable=e=>{if(e.data.size>0)speakChunks[i].push(e.data)};
    mr.onstop=()=>{
      const blob=new Blob(speakChunks[i],{type:'audio/webm'});
      const url=URL.createObjectURL(blob);
      const link=document.getElementById('speaklink'+i); link.innerHTML='';
      const a=document.createElement('a'); a.href=url; a.download='speaking_'+i; a.innerText='Download speaking '+(i+1); link.appendChild(a);
    };
    mr.start(); let sec=0; document.getElementById('timer'+i).innerText='(recording: 0s)';
    timers[i]=setInterval(()=>{ sec++; document.getElementById('timer'+i).innerText='(recording: '+sec+'s)'; if(sec>=120)stopSpeakRec(i); },1000);
  });
}
function stopSpeakRec(i){if(speakMR[i])speakMR[i].stop(); clearInterval(timers[i]); document.getElementById('timer'+i).innerText='';}

/* ------------------ GRAMMAR ------------------ */
function renderGrammar(){
  const container=document.getElementById("mcqcontainer"); container.innerHTML="";
  currentGrammarQuestions=shuffleArray([...grammarSets[currentSet.grammar].questions]);
  currentGrammarQuestions.forEach((q,idx)=>{
    const div=document.createElement("div"); div.className="mcq";
    div.innerHTML=`${idx+1}. ${q.q}<br>`+q.opts.map(opt=>`<label><input type="radio" name="q${idx+1}" value="${opt}"> ${opt}</label>`).join(" ");
    container.appendChild(div);
  });
  const btn=document.createElement("div"); btn.style.marginTop="10px";
  btn.innerHTML=`<button onclick="checkMCQ()">Check Grammar</button> <span id="mcqscore" class="small"></span>`;
  container.appendChild(btn);
}
function checkMCQ(){
  let score=0;
  currentGrammarQuestions.forEach((q,idx)=>{
    const val=document.querySelector(`input[name="q${idx+1}"]:checked`)?.value;
    const divs=document.querySelectorAll("#mcqcontainer .mcq")[idx];
    // Remove previous hints
    divs.querySelectorAll(".correct, .wrong").forEach(el=>el.remove());
    if(val===q.ans){score++; divs.innerHTML+=` <span class="correct">Correct</span>`;}
    else{divs.innerHTML+=` <span class="wrong">Wrong, Answer: ${q.ans}</span>`;}
  });
  document.getElementById("mcqscore").innerText="Score: "+score+"/"+currentGrammarQuestions.length;
  return score;
}

/* ------------------ LISTENING ------------------ */
function renderListening(){
  const section=document.getElementById("listening");
  const lset=listeningSets[currentSet.listening];
  const questions=shuffleArray([...lset.qs]);
  section.innerHTML=`<h2>Section 4 — Listening</h2>
    <button onclick="speakTextPassage()">Play Passage</button>
    <p class="small">${lset.passage}</p>
    <ol>${questions.map(q=>`<li>${q.text} <input id="${q.id}"></li>`).join("")}</ol>
    <div style="margin-top:10px"><button onclick="checkListening()">Check Listening</button> <span id="lsresult" class="small"></span></div>`;
}
function speakTextPassage(){
  const ut=new SpeechSynthesisUtterance(listeningSets[currentSet.listening].passage);
  ut.rate=0.95; window.speechSynthesis.cancel(); window.speechSynthesis.speak(ut);
}
function checkListening(){
  const lset=listeningSets[currentSet.listening]; let c=0;
  lset.qs.forEach(q=>{
    const val=document.getElementById(q.id).value.toLowerCase();
    const inputEl=document.getElementById(q.id);
    inputEl.nextElementSibling?.remove(); // remove previous hints
    const span=document.createElement("span");
    span.className="small";
    if(val.includes(q.ans)){c++; span.style.color="green"; span.innerText=" Correct";}
    else{span.style.color="red"; span.innerText=` Answer: ${q.ans}`;}
    inputEl.after(span);
  });
  document.getElementById("lsresult").innerText="Listening: "+c+"/"+lset.qs.length;
  return c;
}

/* ------------------ SCORE ------------------ */
function showScore(){
  const pronScore=Math.min(10,recordedChunks.filter(ch=>ch.length>0).length*2);
  const speakScore=Math.min(15,speakChunks.filter(ch=>ch.length>0).length*7);
  const g=checkMCQ();
  const l=checkListening();
  const grammarScore=Math.round((g/currentGrammarQuestions.length)*15);
  const listeningScore=Math.round((l/listeningSets[currentSet.listening].qs.length)*20);
  const total=pronScore+speakScore+grammarScore+listeningScore;
  document.getElementById("finalscore").innerText=`Scores:\nPronunciation: ${pronScore}/10\nSpeaking: ${speakScore}/15\nGrammar: ${grammarScore}/15\nListening: ${listeningScore}/20\nTotal: ${total}/60`;
}

/* ------------------ NEXT TEST ------------------ */
function nextTest(){
  usedSets.push(currentSet.pron);
  let availableSets = pronSets.map((_,i)=>i).filter(i=>!usedSets.includes(i));
  if(availableSets.length===0){ alert("All sets completed. Restarting."); usedSets=[]; availableSets=pronSets.map((_,i)=>i);}
  const nextIndex=availableSets[Math.floor(Math.random()*availableSets.length)];
  loadSet(nextIndex);
}

/* ------------------ INIT ------------------ */
window.onload=()=>loadSet(0);
</script>
</body>
</html>
